<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hokkaido Trip | MUJI Premium</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        muji: {
                            bg: '#F8F7F5',
                            text: '#4A4643',
                            sub: '#8F8A83',
                            accent: '#6B655F',
                            border: '#E8E6E3',
                            card: '#FFFEFC'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&family=Noto+Sans+TC:wght@300;400;500&display=swap');
        body { font-family: 'Inter', 'Noto Sans TC', sans-serif; background-color: #F8F7F5; color: #4A4643; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .tab-active { color: #6B655F !important; border-bottom: 2px solid #6B655F; font-weight: 500; }
        .date-card-active { background: #6B655F !important; color: white !important; }
        .fab { position: fixed; bottom: 30px; right: 20px; width: 56px; height: 56px; border-radius: 50%; background: #6B655F; color: white; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(107, 101, 95, 0.2); z-index: 40; }
        input, select, textarea { border: 1px solid #E8E6E3; border-radius: 8px; padding: 10px; background: #FFFEFC; outline: none; width: 100%; color: #4A4643; }
        input:focus { border-color: #6B655F; }
        .modal-overlay { background: rgba(74, 70, 67, 0.4); backdrop-filter: blur(4px); }
    </style>
</head>
<body>

<div id="app" class="max-w-md mx-auto min-h-screen relative pb-24">
    
    <nav class="sticky top-0 z-50 bg-muji-bg/90 backdrop-blur-md border-b border-muji-border">
        <div class="flex justify-around items-center py-4">
            <button @click="activeTab = 'info'" :class="{'tab-active': activeTab === 'info'}" class="pb-2 text-muji-sub"><i class="fa-solid fa-circle-info text-xl"></i></button>
            <button @click="activeTab = 'schedule'" :class="{'tab-active': activeTab === 'schedule'}" class="pb-2 text-muji-sub"><i class="fa-solid fa-calendar-days text-xl"></i></button>
            <button @click="activeTab = 'shopping'" :class="{'tab-active': activeTab === 'shopping'}" class="pb-2 text-muji-sub"><i class="fa-solid fa-cart-shopping text-xl"></i></button>
            <button @click="activeTab = 'spending'" :class="{'tab-active': activeTab === 'spending'}" class="pb-2 text-muji-sub"><i class="fa-solid fa-wallet text-xl"></i></button>
        </div>

        <div v-if="activeTab === 'schedule'" class="flex overflow-x-auto no-scrollbar py-3 px-4 space-x-3 bg-muji-card">
            <div v-for="(day, index) in days" :key="index" 
                 @click="currentDayIndex = index"
                 :class="{'date-card-active': currentDayIndex === index}"
                 class="flex-shrink-0 w-16 h-20 bg-white rounded-xl flex flex-col items-center justify-center border border-muji-border transition-all">
                <span class="text-xs font-medium">Day {{ index + 1 }}</span>
                <span class="text-lg font-bold">{{ day.week }}</span>
                <span class="text-[10px] opacity-60">{{ day.date }}</span>
            </div>
            <button @click="editDates" class="flex-shrink-0 w-10 h-20 border-2 border-dashed border-muji-border rounded-xl text-muji-sub"><i class="fa-solid fa-pen text-xs"></i></button>
        </div>
    </nav>

    <main class="p-5">
        
        <section v-if="activeTab === 'info'" class="space-y-6">
            <div class="bg-white p-5 rounded-2xl border border-muji-border shadow-sm">
                <h3 class="text-[10px] tracking-widest text-muji-sub uppercase mb-3">Currency (JPY â” HKD)</h3>
                <div class="flex items-center space-x-3">
                    <input type="number" v-model="calcJPY" class="text-lg font-medium">
                    <i class="fa-solid fa-arrow-right text-muji-border"></i>
                    <div class="flex-1 text-right text-xl font-bold text-muji-accent">HKD {{ (calcJPY * 0.051).toFixed(2) }}</div>
                </div>
            </div>

            <div class="flex justify-between items-center px-1"><h3 class="text-sm font-medium">èˆªç­è³‡è¨Š</h3><button @click="editFlight" class="text-[10px] underline text-muji-sub">ç·¨è¼¯</button></div>
            <div v-for="f in flights" class="bg-white p-6 rounded-3xl border border-muji-border shadow-sm relative">
                <div class="flex justify-between items-center">
                    <div><p class="text-2xl font-bold">{{ f.from }}</p><p class="text-[10px] text-muji-sub">{{ f.depTime }}</p></div>
                    <div class="flex-1 px-4 flex flex-col items-center">
                        <span class="text-[10px] text-muji-sub">{{ f.no }}</span>
                        <div class="w-full h-[1px] bg-muji-border my-2 relative"><i class="fa-solid fa-plane absolute top-[-5px] left-1/2 -translate-x-1/2 text-[10px] text-muji-border"></i></div>
                        <span class="text-[10px] text-muji-sub">{{ f.duration }}</span>
                    </div>
                    <div class="text-right"><p class="text-2xl font-bold">{{ f.to }}</p><p class="text-[10px] text-muji-sub">{{ f.arrTime }}</p></div>
                </div>
            </div>

            <div class="flex justify-between items-center px-1"><h3 class="text-sm font-medium">ä½å®¿èˆ‡ç§Ÿè»Š</h3><button @click="editAccommodation" class="text-[10px] underline text-muji-sub">ç·¨è¼¯</button></div>
            <div v-for="h in hotels" class="bg-white p-5 rounded-2xl border border-muji-border shadow-sm">
                <h4 class="font-bold text-muji-text">{{ h.name }}</h4>
                <p class="text-xs text-muji-sub mt-2"><i class="fa-solid fa-phone mr-1"></i> {{ h.tel }}</p>
                <p class="text-xs text-muji-sub mt-1"><i class="fa-solid fa-location-dot mr-1"></i> {{ h.address }}</p>
                <button @click="openMap(h.address)" class="mt-4 text-[10px] bg-muji-accent text-white px-4 py-2 rounded-full">é–‹å§‹å°èˆª</button>
            </div>
        </section>

        <section v-if="activeTab === 'schedule'" class="space-y-4">
            <div v-for="(item, idx) in currentItinerary" :key="item.id">
                <div v-if="idx >= 0" class="flex items-center py-2 px-6 space-x-4 opacity-60">
                    <div class="w-px h-6 border-l border-dashed border-muji-accent"></div>
                    <div class="flex items-center text-[10px] space-x-2 text-muji-sub">
                        <i :class="getTransportIcon(item.transport)"></i>
                        <span>ç´„ {{ item.travelTime || '15' }} åˆ†é˜</span>
                    </div>
                </div>

                <div @click="editItem('schedule', item, idx)" class="bg-white p-5 rounded-2xl border border-muji-border shadow-sm group relative">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-[10px] px-2 py-0.5 bg-muji-bg rounded text-muji-sub">{{ item.category }}</span>
                            <h4 class="text-lg font-medium mt-1">{{ item.name }}</h4>
                        </div>
                        <button @click.stop="openMap(item.name)" class="text-muji-sub hover:text-muji-accent"><i class="fa-solid fa-location-arrow"></i></button>
                    </div>
                    <div class="mt-3 grid grid-cols-2 gap-2 text-[11px] text-muji-sub">
                        <span><i class="fa-regular fa-clock mr-1"></i> {{ item.hours || 'ç„¡è³‡æ–™' }}</span>
                        <span v-if="item.ticket"><i class="fa-solid fa-ticket mr-1"></i> Â¥{{ item.ticket }}</span>
                    </div>
                    <p v-if="item.note" class="mt-2 text-[11px] text-muji-sub italic border-t border-muji-border pt-2">{{ item.note }}</p>
                    
                    <div class="absolute -left-2 top-1/2 -translate-y-1/2 flex flex-col space-y-2 opacity-0 group-hover:opacity-100 transition">
                        <button @click.stop="moveItem(idx, -1)" class="w-6 h-6 bg-white border border-muji-border rounded-full text-[10px]">â†‘</button>
                        <button @click.stop="moveItem(idx, 1)" class="w-6 h-6 bg-white border border-muji-border rounded-full text-[10px]">â†“</button>
                    </div>
                </div>
            </div>
        </section>

        <section v-if="activeTab === 'shopping'" class="grid grid-cols-2 gap-4">
            <div v-for="(item, idx) in shoppingList" class="bg-white rounded-3xl overflow-hidden border border-muji-border shadow-sm">
                <div class="aspect-square bg-muji-bg relative flex items-center justify-center">
                    <img v-if="item.img" :src="item.img" class="w-full h-full object-cover">
                    <i v-else class="fa-regular fa-image text-muji-border text-3xl"></i>
                </div>
                <div class="p-3"><p class="text-xs font-medium">{{ item.name }}</p></div>
            </div>
        </section>

        <section v-if="activeTab === 'spending'" class="space-y-6">
            <div class="bg-white p-8 rounded-[2.5rem] border border-muji-border shadow-sm text-center">
                <p class="text-[10px] tracking-widest text-muji-sub uppercase mb-1">Total Spending</p>
                <h2 class="text-4xl font-light text-muji-accent">Â¥ {{ totalSpending.toLocaleString() }}</h2>
                <div class="flex items-center justify-center mt-4 space-x-2">
                    <span class="text-xs text-muji-sub">æ—…è¡Œäººæ•¸:</span>
                    <input type="number" v-model="peopleCount" class="w-12 h-8 text-center bg-muji-bg !p-0">
                </div>
                <p class="text-[10px] text-muji-sub mt-2">äººå‡èŠ±è²»: Â¥ {{ (totalSpending / (peopleCount || 1)).toFixed(0) }}</p>
            </div>

            <div class="space-y-3">
                <div v-for="(ex, idx) in expenses" class="bg-white p-4 rounded-2xl flex justify-between items-center border border-muji-border">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-muji-bg flex items-center justify-center text-xs">ğŸ’¸</div>
                        <div>
                            <p class="text-xs font-medium">{{ ex.name }}</p>
                            <p class="text-[10px] text-muji-sub">{{ ex.date }} Â· ä»˜æ¬¾äºº: {{ ex.payer }}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-sm font-bold">Â¥{{ ex.amount }}</p>
                        <button @click="removeItem('spending', idx)" class="text-[10px] text-red-300">åˆªé™¤</button>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <button @click="openAddModal" class="fab"><i class="fa-solid fa-plus text-xl"></i></button>

    <div v-if="showModal" class="fixed inset-0 z-[100] flex items-end justify-center p-4 modal-overlay" @click.self="showModal = false">
        <div class="bg-white w-full max-w-sm rounded-[2rem] p-6 space-y-4 animate-slide-up shadow-2xl">
            <h3 class="font-bold text-muji-accent">{{ modalTitle }}</h3>
            
            <div v-if="modalType === 'schedule'" class="space-y-3">
                <input v-model="form.name" placeholder="æ™¯é»/ç¾é£Ÿåç¨±">
                <select v-model="form.category"><option>æ™¯é»</option><option>ç¾é£Ÿ</option><option>ä½å®¿</option></select>
                <input v-model="form.hours" placeholder="ç‡Ÿæ¥­æ™‚é–“">
                <input v-model.number="form.ticket" type="number" placeholder="é–€ç¥¨ (æ—¥å¹£)">
                <textarea v-model="form.note" placeholder="å‚™è¨»"></textarea>
                <select v-model="form.transport"><option value="walk">æ­¥è¡Œ</option><option value="car">é–‹è»Š</option><option value="transit">å¤§çœ¾é‹è¼¸</option></select>
            </div>

            <div v-if="modalType === 'spending'" class="space-y-3">
                <input v-model="form.name" placeholder="é …ç›®åç¨±">
                <input v-model.number="form.amount" type="number" placeholder="é‡‘é¡ (æ—¥å¹£)">
                <input v-model="form.payer" placeholder="ä»˜æ¬¾äºº (èª°å¢ŠéŒ¢ï¼Ÿ)">
                <input v-model="form.date" type="date">
            </div>

            <div v-if="modalType === 'info'" class="space-y-3">
                <p class="text-xs text-muji-sub">è«‹åœ¨ç¨‹å¼ç¢¼ Data å€å¡Šæˆ–æ“´å……æ­¤è¡¨å–®ä»¥ç·¨è¼¯å…·é«”èˆªç­</p>
                <input v-model="hotels[0].name" placeholder="é£¯åº—åç¨±">
                <input v-model="hotels[0].address" placeholder="é£¯åº—åœ°å€">
            </div>

            <div class="flex space-x-3 pt-4">
                <button v-if="isEditing" @click="confirmDelete" class="flex-1 py-3 rounded-xl bg-red-50 text-red-400 text-sm">åˆªé™¤</button>
                <button @click="saveData" class="flex-[2] py-3 rounded-xl bg-muji-accent text-white font-medium">å„²å­˜</button>
            </div>
        </div>
    </div>
</div>

<script>
const { createApp, ref, computed } = Vue;

createApp({
    setup() {
        const activeTab = ref('schedule');
        const currentDayIndex = ref(0);
        const calcJPY = ref(1000);
        const peopleCount = ref(2);
        const showModal = ref(false);
        const modalType = ref('');
        const modalTitle = ref('');
        const isEditing = ref(false);
        const editIdx = ref(null);

        // è³‡æ–™
        const days = ref([
            { week: 'Fri', date: '6/1' }, { week: 'Sat', date: '6/2' }, { week: 'Sun', date: '6/3' }
        ]);

        const flights = ref([
            { type: 'å»ç¨‹', from: 'HKG', to: 'CTS', depTime: '09:15', arrTime: '15:10', duration: '4h 55m', no: 'CX580' }
        ]);

        const hotels = ref([
            { name: 'æœ­å¹Œç´¢æ‹‰åˆ©äºè¥¿éµé…’åº—', tel: '+81 11-208-5555', address: 'æœ­å¹Œå¸‚ä¸­å¤®å€åŒ—4æ¡è¥¿6ä¸ç›®1' }
        ]);

        const itinerary = ref({ 0: [{ id: 1, name: 'æ–°åƒæ­²æ©Ÿå ´', category: 'äº¤é€š', transport: 'car', travelTime: '0' }], 1: [], 2: [] });
        const shoppingList = ref([{ name: 'ç™½è‰²æˆ€äºº', img: null }]);
        const expenses = ref([{ name: 'æ‹‰éºµ', amount: 1200, payer: 'A', date: '2025-06-01' }]);

        const form = ref({});

        // è¨ˆç®—
        const currentItinerary = computed(() => itinerary.value[currentDayIndex.value] || []);
        const totalSpending = computed(() => expenses.value.reduce((s, i) => s + i.amount, 0));

        // æ–¹æ³•
        const openMap = (loc) => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(loc + ' åŒ—æµ·é“')}`);
        const getTransportIcon = (t) => t === 'walk' ? 'fa-solid fa-person-walking' : (t === 'car' ? 'fa-solid fa-car' : 'fa-solid fa-train-subway');

        const openAddModal = () => {
            isEditing.value = false;
            modalType.value = activeTab.value;
            modalTitle.value = "æ–°å¢" + activeTab.value;
            form.value = { date: new Date().toISOString().split('T')[0], transport: 'walk', payer: 'è‡ªå·±' };
            showModal.value = true;
        };

        const editItem = (type, item, idx) => {
            isEditing.value = true;
            editIdx.value = idx;
            modalType.value = type;
            modalTitle.value = "ç·¨è¼¯è¡Œç¨‹";
            form.value = { ...item };
            showModal.value = true;
        };

        const editFlight = () => { modalType.value = 'info'; modalTitle.value = "ç·¨è¼¯èˆªç­èˆ‡è³‡è¨Š"; showModal.value = true; };
        const editAccommodation = () => editFlight();

        const saveData = () => {
            if (modalType.value === 'schedule') {
                if (isEditing.value) itinerary.value[currentDayIndex.value][editIdx.value] = { ...form.value };
                else itinerary.value[currentDayIndex.value].push({ ...form.value, id: Date.now() });
            } else if (modalType.value === 'spending') {
                expenses.value.push({ ...form.value });
            }
            showModal.value = false;
        };

        const moveItem = (idx, dir) => {
            const list = itinerary.value[currentDayIndex.value];
            const newIdx = idx + dir;
            if (newIdx >= 0 && newIdx < list.length) [list[idx], list[newIdx]] = [list[newIdx], list[idx]];
        };

        const removeItem = (type, idx) => { if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) expenses.value.splice(idx, 1); };

        return {
            activeTab, currentDayIndex, days, flights, hotels, calcJPY, peopleCount, showModal, modalType, modalTitle, form, isEditing,
            currentItinerary, totalSpending, openMap, getTransportIcon, openAddModal, editItem, editFlight, editAccommodation, saveData, moveItem, removeItem
        };
    }
}).mount('#app');
</script>

<style>
@keyframes slide-up { from { transform: translateY(100%); } to { transform: translateY(0); } }
.animate-slide-up { animation: slide-up 0.3s ease-out; }
</style>
</body>
</html>
